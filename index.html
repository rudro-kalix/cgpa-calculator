<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SGPA Calculator (No Credits, DIU Scale)</title>
<style>
  :root{
    --bg:#0f1220; --card:#171a2b; --muted:#9aa3b2; --text:#eef1f7; --accent:#6ea8fe; --danger:#ff6b6b; --ok:#40c057;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--text);}
  .wrap{max-width:980px; margin:32px auto; padding:0 16px;}
  header{display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px}
  h1{font-size:20px; margin:0}
  .muted{color:var(--muted); font-size:13px}
  .card{background:var(--card); border:1px solid #242842; border-radius:12px; padding:16px}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .pill{display:inline-flex; align-items:center; gap:8px; border:1px solid #2a2f53; background:#121528; color:var(--text); padding:8px 12px; border-radius:999px; font-size:14px}
  .btn{border:1px solid #2a2f53; background:#121528; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; display:inline-block}
  .btn:hover{border-color:#3a4180}
  .btn.primary{background:linear-gradient(180deg,#202a55,#1b2550); border-color:#2c3a7a}
  .btn.danger{border-color:#5c2b2b; background:#2a1212}
  .btn.ghost{background:transparent}
  a.btn{ text-decoration:none; } /* make links look like buttons */

  table{width:100%; border-collapse:separate; border-spacing:0 10px}
  thead th{font-weight:600; color:#b7bfd0; text-align:left; font-size:13px; padding:0 10px}
  tbody td{background:#111427; border:1px solid #242842; padding:10px; vertical-align:middle}
  tbody tr td:first-child{border-radius:8px 0 0 8px}
  tbody tr td:last-child{border-radius:0 8px 8px 0}
  input[type="text"], input[type="number"], select{
    width:100%; padding:10px 12px; border-radius:8px; border:1px solid #2a2f53; background:#0e1122; color:#fff;
  }

  .stat{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
  .chip{
    padding:8px 12px; border-radius:999px;
    background:#0e1329; border:1px solid #2a2f53; color:#c7d0e4; font-size:14px
  }
  .chip1{
    display:inline-flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    padding:12px 20px;
    border-radius:999px;
    background:#0e1329;
    border:1px solid #2a2f53;
    color:#c7d0e4;
    font-size:14px
  }
  .sgpa-label{
    font-weight:800;
    font-size:1.1em;
    line-height:1;
    margin:0;
  }

  .badge{padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid #2a2f53}
  .good{background:#0f2a19; border-color:#294b36; color:#a4f0c6}
  .warn{background:#2a1f0f; border-color:#5a4a2a; color:#ffd28c}
  .bad{background:#2a1212; border-color:#5c2b2b; color:#ffb0b0}
  .ok{background:#10242b; border-color:#2c5561; color:#a7ebff}

  .foot{display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-top:16px}
  .help{font-size:12px; color:#94a0b8}
  .num{font-variant-numeric:tabular-nums}

  /* Highlight SGPA value */
  #sgpa {
    display:inline;
    font-size: 1.8em;
    font-weight: 900;
    color: var(--accent);
    text-shadow: 0 0 6px var(--accent), 0 0 12px var(--accent);
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>SGPA Calculator <span class="muted">(No Credits, DIU Scale)</span></h1>
    <div class="row">
      <label class="pill" title="Toggle between letter grades and numeric grade points">
        <input id="modeSwitch" type="checkbox" />
        <span id="modeLabel">Input mode: <b>Letter Grades</b></span>
      </label>
      <button id="addRow" class="btn primary">+ Add Subject</button>
      <button id="clearAll" class="btn danger">Clear All</button>
      <button id="share" class="btn">Share URL</button>
      <!-- NEW: link to your Marks Needed page -->
      <a href="https://rudro-kalix.github.io/sem.final-need/" class="btn" rel="noopener">Marks Needed Calculator →</a>
    </div>
  </header>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th style="width:42%">Subject</th>
          <th id="colLabel" style="width:42%">Letter Grade (DIU)</th>
          <th style="width:16%">Actions</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="foot">
      <div class="stat">
        <span class="chip">Subjects: <b id="count" class="num">0</b></span>
        <span class="chip1"><span class="sgpa-label">SGPA:</span> <b id="sgpa" class="num">0.00</b></span>
        <span id="standing" class="badge ok">Standing: —</span>
      </div>
      <div class="help">Tip: Switch to grade points if needed using the toggle.</div>
    </div>
  </div>
</div>

<script>
(function(){
  // DIU letter → point mapping
  const MAP = {
    'A+':4.00, 'A':3.75, 'A-':3.50,
    'B+':3.25, 'B':3.00, 'B-':2.75,
    'C+':2.50, 'C':2.25, 'D':2.00, 'F':0.00
  };
  const LETTERS = Object.keys(MAP);

  const tbody = document.getElementById('tbody');
  const countEl = document.getElementById('count');
  const sgpaEl = document.getElementById('sgpa');
  const standingEl = document.getElementById('standing');
  const modeSwitch = document.getElementById('modeSwitch');
  const modeLabel = document.getElementById('modeLabel');
  const colLabel = document.getElementById('colLabel');
  const KEY = 'sgpa_nocredit_diu';

  // ---------- UI creators ----------
  function createLetterSelect(value){
    const sel = document.createElement('select');
    sel.className = 'letter';
    const opts = [
      ['', 'Select grade…'],
      ['A+','A+ (80–100%)'],
      ['A','A (75–79%)'],
      ['A-','A− (70–74%)'],
      ['B+','B+ (65–69%)'],
      ['B','B (60–64%)'],
      ['B-','B− (55–59%)'],
      ['C+','C+ (50–54%)'],
      ['C','C (45–49%)'],
      ['D','D (40–44%)'],
      ['F','F (<40%)']
    ];
    sel.innerHTML = opts.map(([v,t])=>`<option value="${v}">${t}</option>`).join('');
    if (value) sel.value = value;
    sel.onchange = ()=>{ calc(); save(); };
    return sel;
  }
  function createGpInput(value){
    const inp = document.createElement('input');
    inp.type='number'; inp.min='0'; inp.max='4'; inp.step='0.01';
    inp.placeholder='e.g., 3.50'; inp.className='gp';
    if (value!=null) inp.value = value;
    inp.oninput = ()=>{ calc(); save(); };
    return inp;
  }

  function addRow(subject, value){
    const tr = document.createElement('tr');

    const td1 = document.createElement('td');
    const subj = document.createElement('input');
    subj.type='text'; subj.placeholder='Subject name'; subj.className='subj'; subj.value = subject || '';
    subj.oninput = save;
    td1.appendChild(subj);

    const td2 = document.createElement('td');
    // Build control based on CURRENT mode
    td2.appendChild(modeSwitch.checked ? createLetterSelect(value) : createGpInput(value));

    const td3 = document.createElement('td');
    const del = document.createElement('button'); del.className='btn danger'; del.textContent='Delete';
    del.onclick = ()=>{ tr.remove(); calc(); save(); };
    td3.appendChild(del);

    tr.append(td1, td2, td3);
    tbody.appendChild(tr);
  }

  // ---------- persistence ----------
  function serialize(){
    const data = [];
    tbody.querySelectorAll('tr').forEach(tr=>{
      const subject = (tr.querySelector('.subj')?.value || '').trim();
      // Read whichever control actually exists in the row
      const sel = tr.querySelector('.letter');
      const gp  = tr.querySelector('.gp');
      let val = '';
      if (sel) val = sel.value;
      else if (gp) val = gp.value;
      data.push({s:subject, v:val});
    });
    return data;
  }
  function save(){
    const rows = serialize();
    localStorage.setItem(KEY, JSON.stringify({mode:modeSwitch.checked?'letter':'point', rows}));
    // shareable link
    const compact = encodeURIComponent(btoa(JSON.stringify({m:modeSwitch.checked?1:0, r:rows})));
    try{ history.replaceState(null,'',`?d=${compact}`); }catch(e){}
  }
  function load(){
    // Prefer URL payload first
    const params = new URLSearchParams(location.search);
    const d = params.get('d');
    if (d){
      try{
        const payload = JSON.parse(atob(decodeURIComponent(d)));
        modeSwitch.checked = !!payload.m;
        (payload.r||[]).forEach(r=> addRow(r.s||'', r.v||''));
        updateModeUI(); calc(); return;
      }catch(e){}
    }
    // Then localStorage
    const raw = localStorage.getItem(KEY);
    if (raw){
      try{
        const obj = JSON.parse(raw);
        modeSwitch.checked = (obj.mode==='letter');
        (obj.rows||[]).forEach(r=> addRow(r.s, r.v));
        updateModeUI(); calc(); return;
      }catch(e){}
    }
    // Defaults: start in LETTER mode with two blank rows
    modeSwitch.checked = true;
    addRow('Subject 1','');
    addRow('Subject 2','');
    updateModeUI(); calc();
  }

  // ---------- helpers ----------
  function rebuildValueColumn(){
    // Always rebuild controls to match current mode
    const current = serialize();
    tbody.innerHTML = '';
    current.forEach(r=>{
      let v = r.v;
      if (modeSwitch.checked){
        // target = letter
        if (!v) { /* keep blank */ }
        else if (MAP[v] !== undefined) { /* already a letter */ }
        else if (!isNaN(+v)) {
          // numeric -> closest letter
          let best = 'A+', diff = 99;
          for (const L of LETTERS){
            const d = Math.abs(MAP[L]-(+v));
            if (d < diff){ diff = d; best = L; }
          }
          v = best;
        }
      } else {
        // target = points
        if (MAP[v] !== undefined) v = MAP[v].toFixed(2);
        // else if it's already numeric string, keep as-is
      }
      addRow(r.s, v);
    });
  }

  function updateModeUI(){
    const isLetter = modeSwitch.checked;
    modeLabel.innerHTML = `Input mode: <b>${isLetter ? 'Letter Grades' : 'Grade Points'}</b>`;
    colLabel.textContent = isLetter ? 'Letter Grade (DIU)' : 'Grade Point (0–4)';
  }

  function standingTag(g){
    if(g>=3.75) return {cls:'good', text:'Standing: Excellent'};
    if(g>=3.00) return {cls:'ok', text:'Standing: Good'};
    if(g>=2.00) return {cls:'warn', text:'Standing: Satisfactory'};
    return {cls:'bad', text:'Standing: Probation'};
  }

  function calc(){
    let sum=0, n=0;
    tbody.querySelectorAll('tr').forEach(tr=>{
      let gp;
      if(modeSwitch.checked){
        const L = tr.querySelector('.letter').value;
        if (MAP[L] !== undefined) gp = MAP[L];
      } else {
        const v = tr.querySelector('.gp').value;
        if (v !== '') gp = +v;
      }
      if (gp !== undefined){ sum += gp; n++; }
    });
    const sgpa = n ? sum/n : 0;
    document.getElementById('count').textContent = n;
    sgpaEl.textContent = sgpa.toFixed(2);
    const tag = standingTag(sgpa);
    standingEl.className = 'badge ' + tag.cls;
    standingEl.textContent = tag.text;
  }

  // ---------- events ----------
  document.getElementById('addRow').onclick = ()=>{ addRow('', ''); calc(); save(); };
  document.getElementById('clearAll').onclick = ()=>{
    if(confirm('Clear all?')){
      tbody.innerHTML=''; addRow('Subject 1',''); addRow('Subject 2','');
      calc(); save();
    }
  };
  document.getElementById('share').onclick = ()=>{
    save();
    navigator.clipboard.writeText(location.href).then(()=>alert('Link copied!')).catch(()=>{});
  };
  modeSwitch.onchange = ()=>{ updateModeUI(); rebuildValueColumn(); calc(); save(); };

  // boot
  load();
})();
</script>
</body>
</html>
